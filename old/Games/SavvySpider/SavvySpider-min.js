TLORM.QuickEntity.Spider=function(c,a,e,b,d){return c.entity_manager.addEntity(new TLORM.Entity("spider",[TLORM.Component.Render(1,"#FF0"),TLORM.Component.UserControllable(),],a,e,b,d))};TLORM.QuickEntity.Object=function(n,c,a,m,i,r,d,l,b,k){var e=n.entity_manager.addEntity(new TLORM.Entity("name",[TLORM.Component.Render(1,a),],d,l,m,i));var g=d-b;var f=l-k;var j=Math.ceil(Math.max(Math.abs(g)/r,Math.abs(f)/r))||1;var q=-g/j;var p=-f/j;n.entity_manager.addEntityComponent(e,TLORM.Component.Animation(j,function(h){},function(o,h){n.entity_manager.addEntityComponent(e,TLORM.Component.Transform(q,p))},function(h){n.entity_manager.removeEntity(e)}))};TLORM.QuickEntity.Level=function(a,b){TLORM.QuickEntity.Object(a,"object1","#F0F",10,10,10,50,-50,50,500)};TLORM.QuickEntity.World=function(b,a,c){return b.entity_manager.addEntity(new TLORM.Entity("world",[TLORM.Component.Render(1,"#000"),],0,0,a,c))};TLORM.System.UserInput=function(){var a=20;return{type:"UserInput",touch_event:null,init:function(b){var c=this;b.registerEvent("touch",function(d){c.clickHandler(d)});b.registerEvent("click",function(d){c.clickHandler(d)})},clickHandler:function(b){this.touch_event=b},update:function(d){if(this.touch_event){var c=d.entity_manager.getEntitiesByType("UserControllable")[0];var b=c.getComponentByType("Animation");if(b){d.entity_manager.removeEntityComponent(c,b)}this.moveEntity(d,c,{x:Math.floor(this.touch_event.offsetX-c.w/2),y:Math.floor(this.touch_event.offsetY-c.h/2)});this.touch_event=null}},moveEntity:function(h,g,c){var b=g.x-c.x;var i=g.y-c.y;var f=Math.ceil(Math.max(Math.abs(b)/a,Math.abs(i)/a))||1;var e=-b/f;var d=-i/f;h.entity_manager.addEntityComponent(g,TLORM.Component.Animation(f,function(j){},function(k,j){h.entity_manager.addEntityComponent(g,TLORM.Component.Transform(e,d))},function(j){h.entity_manager.addEntityComponent(g,TLORM.Component.Transform(null,null,null,null,c.x,c.y))}))},}};TLORM.System.Render=function(b,a,c){return{type:"Render",context:b,w:a,h:c,update:function(d){this.context.clearRect(0,0,this.w,this.h);var f=this.getEntities(d);for(var e=0;e<f.length;++e){this.renderEntity(f[e])}},renderEntity:function(d){var e=d.getComponentByType("Render");this.context.fillStyle=e.fill_colour;this.context.fillRect(d.x,d.y,d.w,d.h)},getEntities:function(d){return d.entity_manager.getEntitiesByType("Render")}}};window.onload=function(){setup_game()};function setup_game(){var b=document.getElementById("tlorm_game_canvas");var a=new TLORM.Game("SavvySpider",b);var c=TLORM.QuickEntity.World(a,500,500);var d=TLORM.QuickEntity.Spider(a,10,10,20,20);a.setSize(c.w,c.h);TLORM.QuickEntity.Object(a,"object1","#F0F",10,10,4,50,-50,50,600);TLORM.QuickEntity.Object(a,"object2","#0FF",20,20,5,150,-50,150,600);TLORM.QuickEntity.Object(a,"object2","#0FF",20,20,5,15,-50,450,600);a.render_system_manager.addSystem(new TLORM.System.Render(a.canvasContext(),b.width,b.height));a.system_manager.addSystem(new TLORM.System.UserInput());a.start()}TLORM.Component.UserControllable=function(){return{type:"UserControllable",}};