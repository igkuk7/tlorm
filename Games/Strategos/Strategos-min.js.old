TLORM.QuickEntity.Grass=function(c,d,a,f,b,e){return c.entity_manager.addEntity(new TLORM.Entity(d,[TLORM.Component.Cell(),TLORM.Component.Render(1),TLORM.Component.Sprite("../../img/set_0.gif",64,192,16,16,0,0,1,1)],a,f,b,e))};TLORM.QuickEntity.Camera=function(c,d,a,i,b,f,g,e){return c.entity_manager.addEntity(new TLORM.Entity(d,[TLORM.Component.Camera(g,e)],a,i,b,f))};TLORM.QuickEntity.Player=function(c,d,a,f,b,e){return c.entity_manager.addEntity(new TLORM.Entity(d,[TLORM.Component.Cell(),TLORM.Component.Combat(1),TLORM.Component.Render(3,null,null,0.75),TLORM.Component.Sprite("../../img/horsey_black.png",0,0,288,562,0.18,-0.75,1,1.5),TLORM.Component.UserControllable(),TLORM.Component.Physics(true,true)],a,f,b,e))};TLORM.QuickEntity.Enemy=function(c,d,a,g,b,e,f){return c.entity_manager.addEntity(new TLORM.Entity(d,[TLORM.Component.Cell(),TLORM.Component.Combat(2),TLORM.Component.Render(2),TLORM.Component.Sprite("../../img/horsey_white.png",0,0,288,562,0.18,-0.75,1,1.5),TLORM.Component.AI(f),TLORM.Component.Physics(true,true)],a,g,b,e))};TLORM.QuickEntity.Wall=function(c,d,a,f,b,e){return c.entity_manager.addEntity(new TLORM.Entity(d,[TLORM.Component.Cell(),TLORM.Component.Render(1),TLORM.Component.Sprite("../../img/set_0.gif",192,192,16,16,0,0,1,1),TLORM.Component.Physics(true,false)],a,f,b,e))};TLORM.QuickEntity.Level=function(u,t,v,f,m,s,c,h){var a=u.resource_manager.loadFile(t);var b=a.split("\n");var l=null;var g=b.length;var n=0;var r=0;for(var q=0;q<b.length;q++){var e=b[q].split("|");if(e.length>l){l=e.length}for(var p=0;p<e.length;p++){var d=e[p].split(",");for(var o=0;o<d.length;o++){switch(d[o]){case"B":TLORM.QuickEntity.Wall(u,"Wall-"+p+"-"+q,p,q,m,s);break;case"E":TLORM.QuickEntity.Grass(u,"Grass-"+p+"-"+q,p,q,m,s);TLORM.QuickEntity.Enemy(u,"Enemy"+(++n),p,q,m,s);break;case"A":TLORM.QuickEntity.Grass(u,"Grass-"+p+"-"+q,p,q,m,s);TLORM.QuickEntity.Enemy(u,"Enemy"+(++n),p,q,m,s,"Aggressive");break;case"P":TLORM.QuickEntity.Grass(u,"Grass-"+p+"-"+q,p,q,m,s);TLORM.QuickEntity.Player(u,"Player"+(++r),p,q,m,s);break;case" ":TLORM.QuickEntity.Grass(u,"Grass-"+p+"-"+q,p,q,m,s);break;default:break}}}}TLORM.QuickEntity.World(u,"World","#AAACCA",l,g,m,s);return TLORM.QuickEntity.Camera(u,"Camera1",0,0,m*l,s*g,0,0)};TLORM.QuickEntity.World=function(b,c,f,e,d,g,a){return b.entity_manager.addEntity(new TLORM.Entity(c,[TLORM.Component.Grid(e,d,g,a)],0,0,e*g,d*a))};TLORM.System.UserInput=function(){return{type:"UserInput",touch_event:null,touch_event:null,zoom_event:null,move_event:null,up_event:null,current_entity:null,init:function(a){var b=this;a.registerEvent("mousedown",function(c){b.downHandler(c)});a.registerEvent("mousemove",function(c){b.moveHandler(c)});a.registerEvent("mouseup",function(c){b.upHandler(c)});a.registerEvent("mouseout",function(c){b.outHandler(c)});a.registerEvent("touch",function(c){b.clickHandler(c)});a.registerEvent("mousewheel",function(c){b.wheelHandler(c)})},downHandler:function(a){this.down_event=a;this.up_event=null},moveHandler:function(a){this.move_event=a},upHandler:function(a){this.up_event=a},outHandler:function(a){this.down_event=null;this.move_event=null;this.up_event=null},clickHandler:function(a){this.touch_event=a},wheelHandler:function(a){this.zoom_event=a},update:function(m){var a=m.entity_manager.getEntitiesByType("Grid")[0];var l=a.getComponentByType("Grid");var g=m.entity_manager.getEntitiesByType("Camera")[0];var f=g.getComponentByType("Camera");var d=this.cellClicked(m,g,f,a,l);var h=this.mouseDrag(m,g,f,a,l);var k=this.zoomedBy(m);if(d){var e=m.entity_manager.getEntitiesByPosition(d.x,d.y);for(var c=0;c<e.length;++c){var b=e[c];this.setControllable(b);if(this.current_entity){this.moveCurrentEntity(m,b,d)}}this.event=null}else{if(false&&h){var o=h.to.x-h.from.x;var n=h.to.y-h.from.y;f.offset_x+=o;f.offset_y+=n}else{if(false&&k!=0){var j=k*5;l.gw+=k*5;l.gh+=k*5;l.scale=l.gw/l.default_gh}}}},moveCurrentEntity:function(c,b,e){var a=this.current_entity.getComponentByType("MovementPath");if(a){c.entity_manager.removeEntityComponent(this.current_entity,a)}if(b&&b.getComponentByType("AI")){if(this.current_entity){var d=b.getComponentByType("MovementPath");if(d){c.entity_manager.addEntityComponent(this.current_entity,TLORM.Component.MovementPath(d.destination,d.steps[d.current_step-1]),1)}else{c.entity_manager.addEntityComponent(this.current_entity,TLORM.Component.MovementPath({x:b.x,y:b.y},null,1))}}}else{c.entity_manager.addEntityComponent(this.current_entity,TLORM.Component.MovementPath(e))}},setControllable:function(b){var c=b.getComponentByType("UserControllable");if(c){if(this.current_entity){var a=this.current_entity.getComponentByType("UserControllable");a.selected=false}this.current_entity=b;a=this.current_entity.getComponentByType("UserControllable");a.selected=true}},gridPosition:function(j,f,e,a,i,b){var d=b.offsetX-e.offset_x;var c=b.offsetY-e.offset_y;var h=Math.floor(d/i.gw);var g=Math.floor(c/i.gh);return{x:h,y:g}},screenPosition:function(b,d){var c=Math.floor(d.offsetX);var a=Math.floor(d.offsetY);return{x:c,y:a}},cellClicked:function(b,e,h,c,a){var f=null;if(this.down_event&&this.up_event&&!this.down_event.fake){var d=this.gridPosition(b,e,h,c,a,this.down_event);var g=this.gridPosition(b,e,h,c,a,this.up_event);if(d.x===g.x&&d.y===g.y){f=g;this.down_event=null;this.up_event=null}}else{if(this.touch_event){f=this.touch_event;this.touch_event=null}}return f},mouseDrag:function(b,f,h,d,a){var g=null;if(this.down_event){if(this.move_event&&!this.up_event){var e=this.screenPosition(b,this.down_event);var c=this.screenPosition(b,this.move_event);if(e.x!=c.x||e.y!=c.y){g={from:e,to:c};this.down_event=this.move_event;this.down_event.fake=true}this.move_event=null}else{if(this.up_event){this.down_event=null;this.move_event=null;this.up_event=null}}}return g},zoomedBy:function(a){var b=0;if(this.zoom_event){if(this.zoom_event.wheelDelta){b=this.zoom_event.wheelDelta/120}else{if(this.zoom_event.detail){b=-this.zoom_event.detail/3}}this.zoom_event=null}return b}}};TLORM.System.Render=function(b,a,c){return{type:"Render",context:b,w:a,h:c,update:function(s){this.context.clearRect(0,0,this.w,this.h);var n=s.entity_manager.getEntitiesByType("Camera")[0];var m=n?n.getComponentByType("Camera"):null;if(n){this.context.save();this.context.translate(m.offset_x,m.offset_y)}var d=s.entity_manager.getEntitiesByType("Grid")[0];var r=null;var q=0;var l=0;if(d){r=d.getComponentByType("Grid");q=r.gw;l=r.gh;this.renderGrid(s,d,r,q,l)}if(false){this.renderPaths(s,d,q,l)}var f=this.getRenderableEntities(s,d);for(var k=0;k<f.length;++k){for(var h=0;f[k]&&h<f[k].length;++h){var g=f[k][h].entity;if(g===d){continue}var e=f[k][h].render;var p=g.x*q+1;var o=g.y*l+1;this.renderEntity(s,g,e,r,p,o)}}if(n){this.context.restore()}},renderGrid:function(e,k,d,h,m){var l=k.getComponentByType("Render");this.context.clearRect(k.x,k.y,k.w,k.h);if(l){this.context.strokeStyle=l.colour;this.context.strokeRect(k.x,k.y,k.w,k.h);this.context.beginPath();for(var g=0;g<d.w;g++){this.context.moveTo(g*h,k.y);this.context.lineTo(g*h,k.y+k.h);for(var f=0;f<d.h;f++){this.context.moveTo(k.x,f*m);this.context.lineTo(k.x+k.w,f*m)}}this.context.stroke()}},renderPaths:function(n,m,g){this.context.fillStyle="#EEE";var h=n.entity_manager.getEntitiesByType("MovementPath");for(var f=0;f<h.length;++f){var e=h[f];var o=e.getComponentByType("MovementPath");if(o){for(var d=o.current_step;d<o.steps.length;++d){if(o.steps[d]){var l=o.steps[d].x*m+1;var k=o.steps[d].y*g+1;this.context.fillRect(l,k,m-1,g-1)}}}}},getRenderableEntities:function(f,h){var k=f.entity_manager.getEntitiesByType("Render");var e=[];for(var g=0;g<k.length;++g){var d=k[g];if(d===h){continue}var j=d.getComponentByType("Render");if(j){if(!e[j.z]){e[j.z]=[]}e[j.z].push({entity:d,render:j})}}return e},renderEntity:function(u,f,d,t,p,n){if(d.colour){this.context.fillStyle=d.colour;if(t){this.context.fillRect(p,n,t.gw,t.gh)}else{this.context.fillRect(f.x,f.y,f.w,f.h)}}var z=f.getComponentByType("UserControllable");if(z&&z.selected&&d.highlight_alpha){this.context.globalAlpha=d.highlight_alpha}else{this.context.globalAlpha=1}var s=f.getComponentByType("Sprite");if(s){var o=p+(t.gw*s.dx);var m=n+(t.gh*s.dy);var r=t.gw*s.dw;var l=t.gh*s.dh;this.context.drawImage(s.img,s.x,s.y,s.w,s.h,o,m,r,l);var q=f.getComponentByType("Combat");if(q&&q.been_hit){var v=this.context.getImageData(o,m,r,l);for(var k=0;k<l;++k){for(var e=0;e<r;++e){var g=(k+(e*r))*4;v.data[g+0]*=3;v.data[g+1]/=3;v.data[g+2]/=3;if(v.data[g+0]>255){v.data[g+0]=255}}}this.context.putImageData(v,o,m)}}if(d.show_name){var p=f.x*grid_w+1;var n=f.y*grid_h+1;this.context.fillText(f.name,p,n+grid_h-2)}}}};TLORM.System.Combat=function(){return{type:"Combat",update:function(b){var d=b.entity_manager.getEntitiesByType("Combat");for(var c=0;c<d.length;++c){var a=d[c];if(this.surrounded(b,a,d)){b.entity_manager.removeEntity(a);d.splice(c,1)}}},surrounded:function(o,c,g){var a=o.entity_manager.getEntitiesByType("Grid")[0];var n=a.getComponentByType("Grid");var k=c.getComponentByType("Combat");var j={};j[(c.x-1)+","+(c.y)]=1;j[(c.x)+","+(c.y-1)]=1;j[(c.x+1)+","+(c.y)]=1;j[(c.x)+","+(c.y+1)]=1;if(c.x-1<0){j[(c.x-1)+","+(c.y)]=2}if(c.x+1>=n.w){j[(c.x+1)+","+(c.y)]=2}if(c.y-1<0){j[(c.x)+","+(c.y-1)]=2}if(c.y+1>=n.h){j[(c.x)+","+(c.y+1)]=2}var h=g.slice(0);var b=o.entity_manager.getEntitiesByType("Physics");for(var d=0;d<b.length;++d){var f=b[d].getComponentByType("Physics");if(f&&f.can_collide){h.push(b[d])}}for(var d=0;d<h.length;++d){var l=h[d];var e=l.getComponentByType("Combat");if(j[l.x+","+l.y]&&(!e||e.code!=k.code)){++j[l.x+","+l.y]}}for(var m in j){if(!j[m]||j[m]===1){k.been_hit=false;return false}}k.been_hit=true;return true}}};TLORM.System.Movement=function(){return{type:"Movement",update:function(q){var b=q.entity_manager.getEntitiesByType("Grid")[0];var p=b.getComponentByType("Grid");var a=q.entity_manager.getEntitiesByType("Physics");var j=q.entity_manager.getEntitiesByType("MovementPath");for(var h=0;h<j.length;++h){var g=j[h];var r=g.getComponentByType("MovementPath");if(r){if(r.current_step===-1){var m=[];if(r.via){var o=this.find_shortest_path(q,p,{x:g.x,y:g.y},r.via,r.distance);var n=this.find_shortest_path(q,p,r.via,r.destination,r.distance);m=o.concat(n.slice(1))}else{m=this.find_shortest_path(q,p,{x:g.x,y:g.y},r.destination,r.distance)}r.steps=m;r.current_step=0;continue}if(r.current_step_delay++===r.step_delay){r.current_step_delay=0;if(r.steps[r.current_step]){var l=g.x;var k=g.y;g.x=r.steps[r.current_step].x;g.y=r.steps[r.current_step].y;var e=this.checkForCollisions(g,a);if(e){g.x=l;g.y=k;r.steps.splice(r.current_step,r.steps.length-r.current_step)}else{++r.current_step}}else{r.current_step=1;r.steps=[];q.entity_manager.removeEntityComponent(g,r)}}}}var j=q.entity_manager.getEntitiesByType("Movement");for(var h=0;h<j.length;++h){var g=j[h];var c=g.getComponentByType("Movement");if(c){var f=false;var d=false;if(c.incremental){c.prev_x=g.x;c.prev_y=g.y;g.x+=c.x;g.y+=c.y;f=d=true}else{if(g.x<c.x){c.prev_x=g.x;g.x+=c.s;if(g.x>=c.x){f=true;g.x=c.x}}else{if(g.x>c.x){c.prev_x=g.x;g.x-=c.s;if(g.x<=c.x){f=true;g.x=c.x}}else{f=true}}if(g.y<c.y){c.prev_y=g.y;g.y+=c.s;if(g.y>=c.y){d=true;g.y=c.y}}else{if(g.y>c.y){c.prev_y=g.y;g.y-=c.s;if(g.y<=c.y){d=true;g.y=c.y}}else{d=true}}}if(f&&d){q.entity_manager.removeEntityComponent(g,c)}}}},find_shortest_path:function(v,a,h,f,g){var q=[];var m={};var j=[];var t={};var k={x:h.x,y:h.y,F:0,G:0,H:0,parent:null};q.push(k);m[k.x+","+k.y]=k;var l=false;while(q.length>0){q.sort(function(i,d){return(d.F||0)-(i.F||0)});k=q.pop();j.push(k);t[k.x+","+k.y]=k;if(k.x===f.x&&k.y===f.y){l=true;break}var e=this.get_adjacent_cells(v,a,k);for(var r=0;r<e.length;r++){var b=e[r];if(!t[b.x+","+b.y]){var c=(k.x!=b.x&&k.y!=b.y?14:10);if(b.x===f.x&&b.y===f.y){c=0}if(!m[b.x+","+b.y]){b.parent=k;b.G=c+k.G;b.H=(Math.abs(f.x-b.x)+Math.abs(f.y-b.y))*10;b.F=b.G+b.H;q.push(b);m[b.x+","+b.y]=b}else{b=m[b.x+","+b.y];var n=c+k.G;if(n<b.G){b.G=n;b.H=(Math.abs(b.x-h.x)+Math.abs(b.y-h.y))*10;b.F=b.G+b.H;b.parent=k}}}}}if(l){var o=[];k=f;while(k.x!=h.x||k.y!=h.y){o.unshift(k);k=t[k.x+","+k.y].parent}return o}if(g>0){for(var u=1;u<=g;u++){var s=[{x:f.x+u,y:f.y},{x:f.x,y:f.y+u},{x:f.x-u,y:f.y},{x:f.x,y:f.y-u},];for(var r=0;r<s.length;++r){var p=this.find_shortest_path(v,a,h,s[r],0);if(p.length>0){return p}}}}return[]},get_adjacent_cells:function(m,a,k){var n=[{x:k.x-1,y:k.y},{x:k.x,y:k.y-1},{x:k.x+1,y:k.y},{x:k.x,y:k.y+1}];var b=[];for(var e=0;e<n.length;++e){if(n[e].x<0||a.w<=n[e].x||n[e].y<0||a.h<=n[e].y){continue}var h=true;var g=m.entity_manager.getEntitiesByPosition(n[e].x,n[e].y);for(var d=0;d<g.length;++d){var c=g[d];var l=c.getComponentByType("Cell");if(l){var f=c.getComponentByType("Physics");if(f&&f.can_collide){h=false;continue}}}if(h){b.push(n[e])}}return b},collides:function(d,c){var b=d.getComponentByType("Physics");var a=c.getComponentByType("Physics");if(((b&&b.can_collide)||(a&&a.can_collide))&&d.x===c.x&&d.y===c.y){return true}return false},checkForCollisions:function(a,c){for(var b=0;b<c.length;++b){if(c[b]===a){continue}if(this.collides(a,c[b])){return c[b]}}return null}}};TLORM.System.AIInput=function(){var a=30;var b=5;return{type:"AIInput",update:function(l){var c=l.entity_manager.getEntitiesByType("Grid")[0];var k=c.getComponentByType("Grid");var h=l.entity_manager.getEntitiesByType("AI");for(var g=0;g<h.length;++g){var f=h[g];var d=f.getComponentByType("MovementPath");if(!d){var j=f.getComponentByType("AI");if(j.current_delay<=a){j.current_delay+=Math.random();continue}j.current_delay=0;if(j.ai_type==="Aggressive"){if(Math.random()<0.5){var e=this.findNearestEnemy(l,f,j);if(e){this.moveToEnemy(l,f,j,e)}}else{this.randomMovement(l,f,j,k)}}else{this.randomMovement(l,f,j,k)}}}},findNearestEnemy:function(v,k,s){var l=v.entity_manager.getEntitiesByType("Combat");var m=k.getComponentByType("Combat");var d=null;var f=999999;var e=0;for(var r=0;r<l.length;++r){var c=l[r];var n=c.getComponentByType("Combat");if(m.code===n.code){continue}var h=k.x-c.x;var g=k.y-c.y;var p=Math.sqrt(h*h+g*g);if(s.vision<p){continue}var o=this.getSurroundingCells(v,c);var u=[];for(var q=0;q<o.length;++q){var t=o[q].getComponentByType("Combat");if(!t||(t.code!=n.code&&t.code===m.code)){u.push(o)}}if(d===null){d=c;f=p;e=u.length}else{if(u.length>e||(u.length===e&&p<f)){d=c;f=p;e=u.length}}}if(f===1){d=null}return d},moveToEnemy:function(f,e,c,d){f.entity_manager.addEntityComponent(e,TLORM.Component.MovementPath({x:d.x,y:d.y},null,3,b))},randomMovement:function(n,d,g,k){var h=null;var m=false;while(!m){h={x:Math.floor(Math.random()*k.w),y:Math.floor(Math.random()*k.h)};m=true;var l=n.entity_manager.getEntitiesByPosition(h.x,h.y);for(var e=0;e<l.length;e++){var c=l[e];var j=c.getComponentByType("Cell");if(j){var f=c.getComponentByType("Physics");if(f&&f.can_collide){m=false}}}}n.entity_manager.addEntityComponent(d,TLORM.Component.MovementPath(h,null,1,b))},getSurroundingCells:function(m,d){var n=[{x:d.x-1,y:d.y},{x:d.x,y:d.y-1},{x:d.x+1,y:d.y},{x:d.x,y:d.y+1}];var c=[];for(var g=0;g<n.length;++g){var k=m.entity_manager.getEntitiesByPosition(n[g].x,n[g].y);for(var e=0;e<k.length;++e){var f=k[e];var l=f.getComponentByType("Cell");if(l){var h=f.getComponentByType("Physics");if(h&&h.can_collide){c.push(f)}}}}return c}}};TLORM.System.CleanUp=function(a,d,b,c){return{type:"CleanUp",x:a,y:d,w:b,h:c,update:function(g){var j=g.entity_manager.getEntities();for(var h=0;h<j.length;++h){var f=j[h];if(this.leftArea(f)){g.entity_manager.removeEntity(f)}}var e=g.entity_manager.getEntitiesByType("AI");if(e.length===0){g.gameOver(true)}},leftArea:function(e){return false;if(e.x+e.w<this.x||this.x+this.w<e.x||e.y+e.h<this.y||this.y+this.h<e.y){return true}else{return false}}}};TLORM.System.Physics=function(a){return{type:"Physics",context:a,update:function(n){var h=n.entity_manager.getEntitiesByType("Physics");var k={};for(var f=0;f<h.length;++f){var m=h[f];var l;while(l=this.checkForCollisions(m,h)){var g=m.getComponentByType("Physics");var e=l.getComponentByType("Physics");if(g&&g.can_collide&&e&&e.can_collide){var p=m.getComponentByType("MovementPath");var o=l.getComponentByType("MovementPath");if(p){p.steps.splice(p.current_step,p.steps.length-p.current_step)}if(o){o.steps.splice(o.current_step,o.steps.length-o.current_step)}var j=false;for(var f=1;f<20;++f){if(p){var b=p.current_step-f;if(b>=0){m.x=p.steps[b].x;m.y=p.steps[b].y}}if(!this.checkForCollisions(m,h)){j=true;break}if(o){var b=o.current_step-f;if(b>=0){l.x=o.steps[b].x;l.y=o.steps[b].y}}if(!this.checkForCollisions(l,h)){j=true;break}}if(!j){"Unable to avoid collision"}continue;var d=m.getComponentByType("Movement");var c=l.getComponentByType("Movement");if(d){n.entity_manager.removeEntityComponent(m,d)}if(c){n.entity_manager.removeEntityComponent(l,c)}this.avoidOverlaps(m,l,h)}}}},collides:function(c,b){if(c.x===b.x&&c.y===b.y){return true}return false},avoidOverlaps:function(h,f,b){var n=h.getComponentByType("Physics");var m=f.getComponentByType("Physics");var l=h.getComponentByType("Movement");var k=f.getComponentByType("Movement");var p=((l||n.can_move)?h:f);var e=(p===h?f:h);var r=(e.x-p.x);var t=(p.x-e.x);var q=(e.y-p.y);var s=(p.y-e.y);var j=[r,t,q,s];j.sort();var g=false;for(var u=0;u<j.length;++u){var d=p.x;var c=p.y;switch(j[u]){case r:p.x=e.x+1;break;case t:p.x=e.x-1;break;case q:p.y=e.y+1;break;case s:p.y=e.y-1;break;default:break}var o=this.checkForCollisions(p,b);if(o){p.x=d;p.y=c}else{g=true;break}}if(!g){throw"Fatal Error: Unable to avoid overlap"}},checkForCollisions:function(b,d){for(var c=0;c<d.length;++c){if(d[c]===b){continue}if(this.collides(b,d[c])){return d[c]}}return null}}};window.onload=function(){var b=document.getElementById("tlorm_game_canvas");var a=new TLORM.Game("Strategos",b);setup_world(a,b);a.start()};function setup_world(a,b){var c=50;var e=50;var d=TLORM.QuickEntity.Level(a,"levels/test1.txt","World","#AAACCA",c,e,b.width,b.height);a.system_manager.addSystem(new TLORM.System.AIInput());a.system_manager.addSystem(new TLORM.System.UserInput());a.system_manager.addSystem(new TLORM.System.Movement());a.system_manager.addSystem(new TLORM.System.Combat());a.system_manager.addSystem(new TLORM.System.CleanUp(0,0,b.width,b.height));a.system_manager.addSystem(new TLORM.System.Render(a.canvasContext(),b.width,b.height))}TLORM.Component.MovementPath=function(a,b,d,c){return{type:"MovementPath",steps:[],destination:a,via:b,distance:d||0,current_step:-1,step_delay:c||2,current_step_delay:0}};TLORM.Component.AITypes=["Aggressive"];TLORM.Component.AI=function(c){if(c){var b=false;for(var a=0;a<TLORM.Component.AITypes.length;a++){if(TLORM.Component.AITypes[a]===c){b=true;break}}if(!b){throw"Invalid AI type: "+c}}return{type:"AI",ai_type:c,vision:7,current_delay:0}};TLORM.Component.Combat=function(a){return{type:"Combat",code:a,been_hit:false,hit_animation:0,hit_animation_limit:10,}};TLORM.Component.Cell=function(){return{type:"Cell"}};TLORM.Component.Camera=function(b,a){return{type:"Camera",offset_x:b,offset_y:a}};TLORM.Component.Movement=function(a,d,b,c){return{type:"Movement",x:a,y:d,s:b,incremental:c||false,prev_x:null,prev_y:null}};TLORM.Component.Grid=function(a,c,d,b){return{type:"Grid",w:a,h:c,gw:d,gh:b,default_gw:d,default_gh:b,scale:1}};TLORM.Component.UserControllable=function(){return{type:"UserControllable",selected:false}};TLORM.Component.Physics=function(b,a){return{type:"Physics",can_collide:b,can_move:a}};